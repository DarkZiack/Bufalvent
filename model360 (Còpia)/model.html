<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
</head>

<body>
<a-scene cursor="rayOrigin: mouse">

    <a-assets>
        <!-- Sky -->
        <img id="fondo0" src="Assets/imagenes/0.jpg">
        <img id="fondo_blancoYnegro" src="Assets/imagenes/fondo_blancoYnegro.jpg">

        <!-- Fondos -->
        <img id="fondo1" src="Assets/imagenes/1.jpg">
        <img id="fondo2" src="Assets/imagenes/2.jpg">
        <img id="fondo3" src="Assets/imagenes/3.jpg">
        <img id="fondo4" src="Assets/imagenes/4.jpg">
        <img id="fondo5" src="Assets/imagenes/5.jpg">
        <img id="fondo6" src="Assets/imagenes/6.jpg">
        <img id="fondo7" src="Assets/imagenes/7.jpg">
        <img id="fondo8" src="Assets/imagenes/8.jpg">
        <img id="fondo9" src="Assets/imagenes/9.jpg">

        <!-- UI -->
        <img id="dibuplano" src="Assets/imagenes/plano.jpg">
        <img id="bes" src="Assets/imagenes/bes.png">
        <img id="bcat" src="Assets/imagenes/bcat.png">
        <img id="buk" src="Assets/imagenes/buk.png">
        <img id="iconCasa" src="Assets/imagenes/casa.jpg">

        <!-- Audio -->
        <audio id="Intro-cat" src="Assets/audios/cat/Intro.mp3"></audio>
        <audio id="Intro-es" src="Assets/audios/es/Intro.mp3"></audio>
        <audio id="Intro-uk" src="Assets/audios/en/Intro.mp3"></audio>
    </a-assets>

    <a-entity camera look-controls></a-entity>

    <!-- Sky -->
    <a-sky id="sky" src="#fondo_blancoYnegro"></a-sky>

    <!-- Banderas -->
    <a-plane id="es" position="-1.5 -0.5 -2" src="#bes" scale="1 1 1" idioma="es"></a-plane>
    <a-plane id="cat" position="0 -0.5 -2" src="#bcat" scale="1 1 1" idioma="cat"></a-plane>
    <a-plane id="uk" position="1.5 -0.5 -2" src="#buk" scale="1 1 1" idioma="uk"></a-plane>

    <!-- Plano -->
    <a-plane id="plano" position="0 -1 -2" src="#dibuplano" scale="2 1 2" visible="false"></a-plane>

    <!-- Esferas -->
    <script>
        for (let i = 1; i <= 9; i++) {
            document.write(`
                <a-sphere id="esfera${i}"
                    position="0 0 -2"
                    radius="0.03"
                    color="blue"
                    visible="false"
                    animation="property: scale; dur:1000; to:1.2 1.2 1.2; dir:alternate; loop:true"
                    data-fondo="fondo${i}"
                    mostrar-fondo></a-sphere>
            `);
        }
    </script>

    <!-- Casa -->
    <a-plane id="casaBtn" position="2.3 -0.9 -1.8"
             src="#iconCasa" scale="0.4 0.4 0.4"
             visible="false" backtomenu></a-plane>

    <a-entity id="sound" sound></a-entity>

</a-scene>

<script>
const sky = document.querySelector('#sky');
const sound = document.querySelector('#sound');
const mapa = document.querySelector('#plano');
const casaBtn = document.querySelector('#casaBtn');
const banderas = document.querySelectorAll('[idioma]');
let idiomaActual = "cat";

function playIntro() {
    const audio = document.querySelector(`#Intro-${idiomaActual}`);
    if (!audio) return;

    sound.setAttribute('sound', 'src', `#Intro-${idiomaActual}`);
    sound.components.sound.playSound();
}

function entrarEscena(idioma) {
    idiomaActual = idioma;
    sky.setAttribute('src', '#fondo0');
    banderas.forEach(b => b.setAttribute('visible', false));
    document.querySelectorAll('[id^="esfera"]').forEach(e => e.setAttribute('visible', true));
    mapa.setAttribute('visible', true);
    casaBtn.setAttribute('visible', true);
    playIntro();
}

AFRAME.registerComponent('idioma', {
    schema: { default: '' },
    init() {
        this.el.addEventListener('click', () => entrarEscena(this.el.getAttribute('idioma')));
    }
});

AFRAME.registerComponent('mostrar-fondo', {
    init() {
        this.el.addEventListener('click', () => {
            const fondo = this.el.dataset.fondo;
            sky.setAttribute('src', `#${fondo}`);
        });
    }
});

AFRAME.registerComponent('backtomenu', {
    init() {
        this.el.addEventListener('click', () => {
            sky.setAttribute('src', '#fondo_blancoYnegro');
            banderas.forEach(b => b.setAttribute('visible', true));
            document.querySelectorAll('[id^="esfera"]').forEach(e => e.setAttribute('visible', false));
            mapa.setAttribute('visible', false);
            casaBtn.setAttribute('visible', false);
            if (sound.components.sound.isPlaying) sound.components.sound.stopSound();
        });
    }
});
</script>

</body>
</html>
